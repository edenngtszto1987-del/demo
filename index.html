<!DOCTYPE html> <html lang="en"> <head> <meta charset="UTF-8"> <title>Business Performance Dashboard</title> <meta name="viewport" content="width=device-width,initial-scale=1"> <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> <style> :root { --bg:#0f1115; --panel:#1b1f27; --panel-alt:#242b36; --text:#eef2f7; --accent:#3b82f6; --accent2:#10b981; --danger:#ef4444; --warn:#f59e0b; --ok:#10b981; --muted:#8a94a6; --grid:#2c3442; --font:"Segoe UI",system-ui,Arial,sans-serif; } * { box-sizing:border-box; } body { margin:0; font-family:var(--font); background:var(--bg); color:var(--text); line-height:1.4; } h1,h2,h3 { font-weight:600; margin:0 0 .6rem; } h1 { font-size:1.8rem; } h2 { font-size:1.3rem; } header { padding:1.2rem 1.4rem; background:linear-gradient(90deg,#1b2532,#18222d); display:flex; flex-wrap:wrap; gap:1rem; align-items:center; justify-content:space-between; border-bottom:1px solid var(--grid); } header .title-wrap { display:flex; flex-direction:column; gap:.35rem; } header h1 span { font-weight:300; font-size:.9rem; color:var(--muted); display:block; } .layout { display:grid; grid-template-columns:300px 1fr; gap:1rem; padding:1rem; } @media (max-width:1150px){ .layout { grid-template-columns:1fr; } .sticky-col { position:static !important; } } .panel { background:var(--panel); padding:1rem 1.1rem 1.2rem; border-radius:12px; border:1px solid var(--grid); display:flex; flex-direction:column; gap:.8rem; position:relative; } .panel.alt { background:var(--panel-alt); } .kpi-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(160px,1fr)); gap:.8rem; } .kpi { background:var(--panel-alt); padding:.7rem .8rem; border-radius:10px; border:1px solid var(--grid); display:flex; flex-direction:column; gap:.2rem; } .kpi small { font-size:.7rem; letter-spacing:.05em; color:var(--muted); text-transform:uppercase; } .kpi .val { font-weight:600; font-size:1.05rem; } .kpi.good { box-shadow:0 0 0 1px #064e3b; } .kpi.warn { box-shadow:0 0 0 1px #78350f; } .kpi.bad { box-shadow:0 0 0 1px #7f1d1d; } .toolbar { display:flex; flex-wrap:wrap; gap:.6rem; align-items:center; } .toolbar input,.toolbar select { background:#13181f; border:1px solid var(--grid); padding:.5rem .65rem; border-radius:6px; color:var(--text); font-size:.85rem; min-width:140px; } button { background:var(--accent); color:#fff; border:none; padding:.55rem .9rem; border-radius:6px; font-size:.8rem; font-weight:600; letter-spacing:.03em; cursor:pointer; display:inline-flex; gap:.4rem; align-items:center; } button.secondary { background:#374151; } table { width:100%; border-collapse:collapse; font-size:.78rem; } thead th { position:sticky; top:0; background:#202833; z-index:2; cursor:pointer; white-space:nowrap; user-select:none; } th,td { padding:.4rem .5rem; border-bottom:1px solid #26303d; text-align:right; } tbody tr:hover { background:#202a35; } tbody tr.selected { background:#253447 !important; } th:first-child,td:first-child { text-align:left; position:sticky; left:0; background:linear-gradient(90deg,#202833,#1d252f); z-index:1; } .note { font-size:.65rem; color:var(--muted); } .pill { background:#2d3845; padding:.3rem .55rem; border-radius:50px; font-size:.6rem; text-transform:uppercase; letter-spacing:.07em; } .separator { height:1px; background:linear-gradient(90deg,transparent,#2d3743,transparent); margin:.6rem 0; } footer { text-align:center; padding:1.5rem .5rem 3rem; font-size:.65rem; color:var(--muted); } .tag-cloud { display:flex; flex-wrap:wrap; gap:.4rem; } .tag-cloud span { background:#24313e; padding:.3rem .55rem; border-radius:6px; font-size:.6rem; color:var(--muted); } .pulse { position:absolute; top:10px; right:12px; width:10px; height:10px; background:var(--accent2); border-radius:50%; box-shadow:0 0 0 0 rgba(16,185,129,.7); animation:pulse 2.6s infinite; } @keyframes pulse { 0% { box-shadow:0 0 0 0 rgba(16,185,129,.6);} 70% { box-shadow:0 0 0 12px rgba(16,185,129,0);} 100% { box-shadow:0 0 0 0 rgba(16,185,129,0);} } .two-col { display:grid; gap:1rem; grid-template-columns:repeat(auto-fit,minmax(320px,1fr)); } .sticky-col { position:sticky; top:.75rem; align-self:start; max-height:calc(100vh - 1.5rem); overflow:auto; scrollbar-width:thin; } ::-webkit-scrollbar { width:8px; height:8px; } ::-webkit-scrollbar-track { background:#141a21; } ::-webkit-scrollbar-thumb { background:#2d3743; border-radius:4px; } .swot-grid { display:grid; gap:.8rem; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); } .swot { background:#202a34; border:1px solid #2f3b49; padding:.7rem .75rem; border-radius:10px; } .swot h3 { margin:0 0 .4rem; font-size:.85rem; letter-spacing:.05em; text-transform:uppercase; } .swot ul { margin:.2rem 0 0; padding-left:1.1rem; font-size:.68rem; line-height:1.2; } .plan-steps ol { margin:.4rem 0 .2rem; padding-left:1.1rem; font-size:.7rem; line-height:1.25;} details summary { cursor:pointer; list-style:none; font-weight:600; margin-bottom:.4rem; } details[open] summary { color:var(--accent); } .highlight { color:var(--accent2); font-weight:600; } .grow { width:100%; } </style> </head> <body> <header> <div class="title-wrap"> <h1>Business Performance Dashboard <span>Static • Client-Side Only</span></h1> <div class="tag-cloud"> <span>KPIs</span><span>Growth</span><span>Portfolio</span><span>Export</span><span>Analytics</span> </div> </div> <div style="display:flex;flex-direction:column;gap:.4rem;"> <div class="pill">v1.0</div> <small class="muted">All in browser</small> </div> </header> <div class="layout"> <div class="sticky-col" style="display:flex; flex-direction:column; gap:1rem;"> <div class="panel"> <div class="pulse" title="Auto KPIs"></div> <h2>Executive KPIs</h2> <div id="kpiContainer" class="kpi-grid"></div> <div class="note">指標自動由資料計算。Null = 無資料。</div> </div> <div class="panel alt"> <h2>Filters & Tools</h2> <div class="toolbar"> <input type="text" id="searchBox" placeholder="Search company..."> <select id="sortSelect"> <option value="company-asc">Company A→Z</option> <option value="company-desc">Company Z→A</option> <option value="value1-desc">Value1 High→Low</option> <option value="value1-asc">Value1 Low→High</option> <option value="growth-desc">Growth High→Low</option> <option value="growth-asc">Growth Low→High</option> <option value="avg-desc">Average High→Low</option> </select> <button id="resetBtn">Reset</button> <button id="exportBtn" class="secondary">Export CSV</button> </div> <div class="note">點選下方表格列 → 更新折線圖</div> </div> <div class="panel"> <h2>Quick Strategy Snapshot</h2> <div class="swot-grid"> <div class="swot"><h3>Strengths</h3><ul><li>Top tier strong</li><li>Mid-tier growth</li><li>Diversification window</li></ul></div> <div class="swot"><h3>Weaknesses</h3><ul><li>Data gaps</li><li>Concentration risk</li><li>Volatility pockets</li></ul></div> <div class="swot"><h3>Opportunities</h3><ul><li>Upsell mid-tier</li><li>Data quality lift</li><li>Revive laggards</li></ul></div> <div class="swot"><h3>Threats</h3><ul><li>Over‑dependency</li><li>Hidden decline</li><li>Competitive churn</li></ul></div> </div> <div class="separator"></div> <div class="plan-steps"> <strong>12‑Month Targets</strong> <ol> <li>Top5 share &lt; 50%</li> <li>Data completeness ≥ 95%</li> <li>Mid-tier growth playbooks</li> <li>Variance alerts</li> <li>Decline early detection</li> </ol> </div> </div> </div> <div style="display:flex; flex-direction:column; gap:1rem;"> <div class="panel"> <h2>Portfolio & Growth Visuals</h2> <div class="two-col"> <div class="grow"><canvas id="pieTop"></canvas></div> <div class="grow"><canvas id="barAll"></canvas></div> </div> <div class="separator"></div> <div class="two-col"> <div class="grow"> <h3 style="margin-top:0;">Selected Company Trend</h3> <canvas id="lineSelected"></canvas> <div class="note" id="selectedMeta">Click a company row below.</div> </div> <div class="grow"> <h3 style="margin-top:0;">Growth Distribution</h3> <canvas id="histGrowth"></canvas> <div class="note">Histogram of growth % (公司級別)</div> </div> </div> </div> <div class="panel alt"> <h2>Detailed Data Table</h2> <div style="overflow:auto; max-height:500px; border:1px solid #2c3744; border-radius:10px;"> <table id="dataTable"><thead id="tableHead"></thead><tbody id="tableBody"></tbody></table> </div> <div class="note">Value1 = Base • Value2~Value10 = Period1..Period9</div> </div> <div class="panel"> <h2>Narrative Analytics</h2> <details open><summary>Concentration & Diversification</summary><div id="concentrationText" style="font-size:.72rem;"></div></details> <details><summary>Growth & Momentum</summary><div id="growthText" style="font-size:.72rem;"></div></details> <details><summary>Data Quality & Recommendations</summary><div id="qualityText" style="font-size:.72rem;"></div></details> <details><summary>Actionable Playbook</summary> <ul style="font-size:.72rem; line-height:1.25; margin:.4rem 0 .2rem; padding-left:1.05rem;"> <li>Tier segmentation</li><li>Owner assignment</li><li>Monthly risk scan</li><li>Completeness scorecards</li><li>Alert large swings</li> </ul> </details> </div> <div class="panel alt"> <h2>How To Modify Data</h2> <ol style="font-size:.68rem; line-height:1.25; margin:.4rem 0 .2rem; padding-left:1.2rem;"> <li>在此檔案內找到 const rawData</li> <li>新增 / 修改公司 (null = 無資料)</li> <li>儲存並重新整理</li> </ol> </div> </div> </div> <footer>Static dashboard. All logic runs locally. © Demo</footer> <script> const rawData=[{company:"AMG",values:[109100227.48,3065177.12,21411382.17,9436905.88,10568518.31,8549538.15,8009146.89,15409556.13,16723468.96,16970356.33]},{company:"Mackenzie",values:[37370000,779570,1013441.08,935484,488010.82,893262.5,1631175,1443000,1339893.75,2223000]},{company:"ASI",values:[141613346.48,1948925,18506991.8,116935.5,9744625,3883750,10595025,3143400,9855679.4,156000]},{company:"Macroscopica",values:[83681565.91,null,5635121.75,1735325,2293576,3107000,9903365.16,4562613.91,2320452.5,780000]},{company:"Best Manage",values:[200306554.91,2462471.71,11823942.68,10988489.12,5726051.96,2601618.95,7825575.46,7760164.59,15989986.43,3671390]},{company:"BS",values:[null,2052763.72,1233587.12,6286452.48,728438.63,2046565.37,1501111.57,4811893.48,3175116.9,2384104.32]},{company:"Colman Li",values:[32707408.98,707870,6002689,17889268,45215060,8422549.99,40428175,20671853.58,6955725,34597185.5]},{company:"Fortunaire",values:[60823889.14,2585812.69,7566720.42,4092742.5,11592860.74,10532969.86,8151659.79,4827845.1,8750577.25,6058072.8]},{company:"GT",values:[18709680.11,4233594.12,37687690.88,8282002.7,15828260.26,16503591.25,15443099.45,18127453.36,14547197.7,20913836.74]},{company:"Grantag",values:[28850826.2,389785,null,467742,1559140,4660500,21999839.06,null,233025,4469879.06]},{company:"ISA",values:[116110481.07,140322.6,4743511.94,2862986.81,16421493.15,6055018.43,11226426.97,10374280.85,7917216.16,3680591.87]},{company:"KGI",values:[84326862.57,194892.5,2080467.7,1181746.85,3643708.3,null,1095214,1592290.85,4550359.53,5955503.35]},{company:"MG",values:[43066606.86,null,34494881.1,1822668.67,919089.02,3742496.69,2166797.05,1592290.85,18539028.41,3512611.18]},{company:"MHK",values:[48088087.16,null,3118280,12083335,7483872,7534475,22914125,36274101.67,466050,null]},{company:"New Centry",values:[64781869.91,1948925,36993983.32,26232530.5,1481183,null,3604275,6888101.75,343948,null]},{company:"NEW Universe",values:[12256097.22,951075.4,3393748.86,1551344.3,5636291.1,1810293.55,3170965.44,3416400,11487779.08,1521000]},{company:"Wisdom",values:[52039273.12,187096.8,10827662.88,5180525.33,15276274.42,9845231.42,31723232.29,10388372.3,9871638.04,12836070.15]},{company:"Wise Fortune",values:[8756585.96,1408036.86,3296840.43,462911.81,3209622.92,4707649.92,2707245.61,2748362.53,10970663.97,4256722.63]},{company:"WRISE",values:[8083514.42,7491214.68,9070561.49,6255652.34,7322617.6,5661349.39,3528387.84,2680016.76,5873313.05,9712954.55]},{company:"Dynasty",values:[null,null,null,null,null,4269546.54,3453726.5,4294199.2,4439922.6,2799536.07]},{company:"Hanligent",values:[null,null,null,null,null,null,null,null,21604413,null]},{company:"NNI",values:[null,null,null,null,null,null,null,null,609748.75,null]},{company:"Insurance 110",values:[null,null,null,null,null,null,null,null,2807454.13,1544389.7]},{company:"JA.F",values:[null,null,null,null,null,null,null,null,2738307.22,1289510.6]},{company:"First Wealth",values:[null,null,null,null,null,null,null,null,815587.5,null]},{company:"Total",values:[1150672877.50,30547533.2,218901504.62,117865048.79,165138693.23,104827407.01,211078568.08,161006196.91,182926552.33,139332714.85]}]; const valueLabels=["Value1","Value2","Value3","Value4","Value5","Value6","Value7","Value8","Value9","Value10"]; const periodLabels=["Period1","Period2","Period3","Period4","Period5","Period6","Period7","Period8","Period9"]; const safeNumber=x=>(x===null||x===undefined||isNaN(+x))?null:+x; const formatFull=n=> (n==null||isNaN(n))?"-":n.toLocaleString(undefined,{minimumFractionDigits:0,maximumFractionDigits:2}); const formatPct=(x,d=1)=> (x==null||isNaN(x))?"-":(x*100).toFixed(d)+"%"; const avgNonNull=arr=>{const v=arr.filter(x=>x!==null);return v.length? v.reduce((a,b)=>a+b,0)/v.length : null;}; function computeGrowth(values){const p=values.slice(1);const f=p.find(v=>v!==null);const l=[...p].reverse().find(v=>v!==null);if(f==null||l==null||f===0)return null;return (l-f)/f;} function completeness(values){const nn=values.filter(v=>v!==null).length;return nn/values.length;} const rawClean=rawData.filter(r=>r.company&&r.company.trim()).map(r=>({company:r.company.trim(),values:r.values.map(safeNumber)})); const working=rawClean.filter(r=>r.company.toLowerCase()!=="total"); const sumValue1=working.reduce((s,r)=>s+(r.values[0]||0),0); const enriched=working.map(r=>{const growth=computeGrowth(r.values);const avgP=avgNonNull(r.values.slice(1));const comp=completeness(r.values);const v1=r.values[0];const share=v1? v1/(sumValue1||1):null;return {company:r.company,values:r.values,value1:v1,growth,avgPeriod:avgP,completeness:comp,share};}); let filtered=[...enriched],currentSort="company-asc",currentSelected=null; let pieChart,barChart,lineChart,histChart; function buildKPIs(){const box=document.getElementById("kpiContainer");box.innerHTML="";const totalCompanies=enriched.length;const withGrowth=enriched.filter(e=>e.growth!==null);const avgGrowth=withGrowth.length?withGrowth.reduce((a,b)=>a+b.growth,0)/withGrowth.length:null;const avgCompleteness=enriched.reduce((a,b)=>a+b.completeness,0)/totalCompanies;const topShare=[...enriched].sort((a,b)=>(b.value1||0)-(a.value1||0)).slice(0,1).reduce((s,r)=>s+(r.share||0),0);const top5Share=[...enriched].sort((a,b)=>(b.value1||0)-(a.value1||0)).slice(0,5).reduce((s,r)=>s+(r.share||0),0);const totalValue1=sumValue1;[{label:"Companies",value:totalCompanies},{label:"Total Value1",value:formatFull(totalValue1)},{label:"Avg Growth",value:formatPct(avgGrowth),cls:avgGrowth>0?"good":"bad"},{label:"Avg Completeness",value:formatPct(avgCompleteness),cls:avgCompleteness>0.8?"good":(avgCompleteness>0.5?"warn":"bad")},{label:"Top1 Share",value:formatPct(topShare),cls:topShare<0.35?"good":"warn"},{label:"Top5 Share",value:formatPct(top5Share),cls:top5Share<0.6?"good":"warn"},{label:"With Growth%",value:withGrowth.length+"/"+totalCompanies}].forEach(k=>{const d=document.createElement("div");d.className="kpi";if(k.cls)d.classList.add(k.cls);d.innerHTML=`<small>${k.label}</small><span class="val">${k.value}</span>`;box.appendChild(d);});} function buildTable(){const thead=document.getElementById("tableHead");const tbody=document.getElementById("tableBody");const headers=["Company","Value1","Growth%","Avg Period","Complete%","Share%"].concat(valueLabels.slice(1));thead.innerHTML="<tr>"+headers.map(h=>`<th>${h}</th>`).join("")+"</tr>";tbody.innerHTML="";filtered.forEach(r=>{const tr=document.createElement("tr");tr.dataset.company=r.company;tr.innerHTML=`<td>${r.company}</td><td>${r.value1!==null?formatFull(r.value1):"-"}</td><td>${r.growth!==null?(r.growth*100).toFixed(1)+"%":"-"}</td><td>${r.avgPeriod!==null?formatFull(r.avgPeriod):"-"}</td><td>${formatPct(r.completeness,0)}</td><td>${r.share!==null?formatPct(r.share,1):"-"}</td>${r.values.slice(1).map(v=>`<td>${v!==null?formatFull(v):"-"}</td>`).join("")}`;tr.addEventListener("click",()=>{document.querySelectorAll("#tableBody tr").forEach(rr=>rr.classList.remove("selected"));tr.classList.add("selected");currentSelected=r.company;updateLineChart(r);});tbody.appendChild(tr);});if(filtered.length&&!currentSelected){const first=filtered[0];currentSelected=first.company;tbody.querySelector("tr")?.classList.add("selected");updateLineChart(first);}else if(currentSelected){tbody.querySelector(`tr[data-company="${currentSelected}"]`)?.classList.add("selected");}} function applySort(){filtered.sort((a,b)=>{switch(currentSort){case"company-asc":return a.company.localeCompare(b.company);case"company-desc":return b.company.localeCompare(a.company);case"value1-desc":return (b.value1||0)-(a.value1||0);case"value1-asc":return (a.value1||0)-(b.value1||0);case"growth-desc":return (b.growth??-Infinity)-(a.growth??-Infinity);case"growth-asc":return (a.growth??Infinity)-(b.growth??Infinity);case"avg-desc":return (b.avgPeriod??-Infinity)-(a.avgPeriod??-Infinity);default:return 0;}});} function applyFilterAndSort(){const kw=document.getElementById("searchBox").value.trim().toLowerCase();filtered=enriched.filter(r=>r.company.toLowerCase().includes(kw));applySort();buildTable();updateAllCharts();updateNarratives();} function palette(i){const c=["#3b82f6","#10b981","#f59e0b","#6366f1","#ef4444","#14b8a6","#8b5cf6","#ec4899","#0ea5e9","#84cc16","#d946ef","#fb7185","#22c55e","#c084fc","#f97316"];return c[i%c.length];} function updatePie(){const ctx=document.getElementById("pieTop").getContext("2d");const sorted=[...filtered].filter(r=>r.value1).sort((a,b)=>(b.value1||0)-(a.value1||0));const top5=sorted.slice(0,5);const others=sorted.slice(5).reduce((s,r)=>s+(r.value1||0),0);const labels=top5.map(r=>r.company);const dataVals=top5.map(r=>r.value1);if(others>0){labels.push("Others");dataVals.push(others);}pieChart&&pieChart.destroy();pieChart=new Chart(ctx,{type:"doughnut",data:{labels,datasets:[{data:dataVals,backgroundColor:labels.map((_,i)=>palette(i)),borderWidth:1,borderColor:"#1b1f27"}]},options:{plugins:{title:{display:true,text:"Top Companies Share"},legend:{labels:{color:"#d0d6dd"}}}}});} function updateBar(){const ctx=document.getElementById("barAll").getContext("2d");const sorted=[...filtered].sort((a,b)=>(b.value1||0)-(a.value1||0));barChart&&barChart.destroy();barChart=new Chart(ctx,{type:"bar",data:{labels:sorted.map(r=>r.company),datasets:[{label:"Value1",data:sorted.map(r=>r.value1||0),backgroundColor:sorted.map((_,i)=>palette(i))}]},options:{plugins:{title:{display:true,text:"Value1 by Company"},legend:{display:false}},scales:{x:{ticks:{color:"#d0d6dd"}},y:{ticks:{color:"#d0d6dd"}}}}});} function updateLineChart(rec){const ctx=document.getElementById("lineSelected").getContext("2d");const labels=["Value1",...periodLabels];lineChart&&lineChart.destroy();lineChart=new Chart(ctx,{type:"line",data:{labels,datasets:[{label:rec.company,data:rec.values,spanGaps:true,borderColor:"#3b82f6",backgroundColor:"rgba(59,130,246,.25)",tension:.25,pointRadius:4,pointHoverRadius:6}]},options:{plugins:{title:{display:true,text:"Trend (Base + Periods)"},legend:{labels:{color:"#d0d6dd"}},tooltip:{callbacks:{label:ctx=>{const v=ctx.parsed.y;return `${ctx.dataset.label}: ${v===null?"(no data)":formatFull(v)}`;}}}},scales:{x:{ticks:{color:"#d0d6dd"}},y:{ticks:{color:"#d0d6dd"}}}}});document.getElementById("selectedMeta").innerHTML=`<span class="highlight">${rec.company}</span> | Growth: ${formatPct(rec.growth)} | Completeness: ${formatPct(rec.completeness)}`;} function updateHist(){const ctx=document.getElementById("histGrowth").getContext("2d");const gvals=filtered.map(r=>r.growth).filter(g=>g!==null);const min=-1,max=2,bucketSize=0.15,buckets=[];for(let s=min;s<max;s+=bucketSize)buckets.push({start:s,end:s+bucketSize,count:0});gvals.forEach(g=>{const b=buckets.find(bk=>g>=bk.start&&g<bk.end);if(b)b.count++;});const labels=buckets.map(b=>`${(b.start*100).toFixed(0)}%~${(b.end*100).toFixed(0)}%`);const counts=buckets.map(b=>b.count);histChart&&histChart.destroy();histChart=new Chart(ctx,{type:"bar",data:{labels,datasets:[{label:"Companies",data:counts,backgroundColor:"#10b981"}]},options:{plugins:{title:{display:true,text:"Growth % Distribution"},legend:{display:false}},scales:{x:{ticks:{color:"#d0d6dd",maxRotation:80,minRotation:45}},y:{ticks:{color:"#d0d6dd",precision:0}}}}});} function updateAllCharts(){updatePie();updateBar();updateHist();if(currentSelected){const rec=filtered.find(r=>r.company===currentSelected);if(rec)updateLineChart(rec);else{currentSelected=null;document.getElementById("selectedMeta").textContent="Click a company row below.";lineChart&&lineChart.destroy();lineChart=null;}}} function updateNarratives(){const sorted=[...filtered].filter(r=>r.value1).sort((a,b)=>(b.value1||0)-(a.value1||0));const totalV1=sorted.reduce((s,r)=>s+(r.value1||0),0);const top1Share=sorted[0]?sorted[0].value1/totalV1:0;const top5Share=sorted.slice(0,5).reduce((s,r)=>s+(r.value1||0),0)/(totalV1||1);document.getElementById("concentrationText").textContent=`目前 Top1 佔比 ${formatPct(top1Share)}，Top5 合計 ${formatPct(top5Share)}。${top5Share>0.6?"集中度偏高，建議推動中長尾放大。":"集中度尚可，可持續培育中層客戶。"}`;const gvals=filtered.map(r=>r.growth).filter(g=>g!==null);const avgG=gvals.length?gvals.reduce((a,b)=>a+b,0)/gvals.length:null;const pos=gvals.filter(g=>g>0).length;const neg=gvals.filter(g=>g<0).length;document.getElementById("growthText").textContent=`可計算成長的公司 ${gvals.length} 家；平均成長 ${formatPct(avgG)}；上升 ${pos} 家 vs 下降 ${neg} 家。${avgG>0?"動能正向":"需留意下行壓力"}。`;const avgComp=filtered.reduce((a,b)=>a+b.completeness,0)/(filtered.length||1);const goodComp=filtered.filter(r=>r.completeness>=0.9).length;document.getElementById("qualityText").textContent=`平均完整度 ${formatPct(avgComp)}；≥90% 完整度公司 ${goodComp} 家 (${formatPct(goodComp/(filtered.length||1))})。${avgComp<0.7?"優先補資料，再談精細分析。":"資料品質足以支撐更進階分析。"}`;} function exportCSV(){if(!filtered.length){alert("無資料可匯出");return;}const cols=["Company","Value1","Growth","AvgPeriod","Completeness","Share"].concat(valueLabels.slice(1));const lines=[cols.join(",")];filtered.forEach(r=>{lines.push([`"${r.company.replace(/"/g,'""')}"`,r.value1??"",r.growth??"",r.avgPeriod??"",r.completeness??"",r.share??"",...r.values.slice(1).map(v=>v??"")].join(","));});const blob=new Blob([lines.join("\n")],{type:"text/csv"});const a=document.createElement("a");a.href=URL.createObjectURL(blob);a.download="dashboard_export.csv";a.click();} function initEvents(){document.getElementById("searchBox").addEventListener("input",applyFilterAndSort);document.getElementById("sortSelect").addEventListener("change",e=>{currentSort=e.target.value;applyFilterAndSort();});document.getElementById("resetBtn").addEventListener("click",()=>{document.getElementById("searchBox").value="";currentSort="company-asc";document.getElementById("sortSelect").value="company-asc";currentSelected=null;applyFilterAndSort();});document.getElementById("exportBtn").addEventListener("click",exportCSV);} function init(){buildKPIs();applyFilterAndSort();initEvents();updateNarratives();} document.addEventListener("DOMContentLoaded",init); </script> </body> </html>
